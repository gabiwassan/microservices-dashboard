import{w}from"./with-props-GPLnpKcb.js";import{j as e,r as o,e as N,f as k,g as S,h as L,b as C}from"./chunk-HA7DTUK3-BY0tfoDu.js";function A({status:r}){const t=()=>{switch(r){case"running":return"bg-green-100 text-green-800";case"stopped":return"bg-gray-100 text-gray-800";case"error":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}},c=()=>{switch(r){case"running":return"Running";case"stopped":return"Stopped";case"error":return"Error";default:return"Unknown"}};return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t()}`,children:[e.jsx("span",{className:`w-2 h-2 mr-1.5 rounded-full ${r==="running"?"bg-green-600 animate-pulse":"bg-gray-400"}`}),c()]})}const R=[100,500,1e3,2e3,5e3],E={logs:[],totalLogs:0,maxLogs:1e3,autoScroll:!0};function O(r,t){switch(t.type){case"ADD_LOG":return{...r,logs:[...r.logs,t.payload].slice(-r.maxLogs),totalLogs:r.totalLogs+1};case"CLEAR_LOGS":return{...r,logs:[],totalLogs:0};case"SET_MAX_LOGS":return{...r,maxLogs:t.payload,logs:r.logs.slice(-t.payload)};case"SET_AUTO_SCROLL":return{...r,autoScroll:t.payload};default:return r}}function T({serviceId:r,isVisible:t}){const[c,i]=o.useReducer(O,E),d=o.useRef(null),a=o.useCallback(l=>{i({type:"ADD_LOG",payload:l})},[]),p=o.useCallback(()=>{i({type:"CLEAR_LOGS"})},[]),h=o.useCallback(l=>{i({type:"SET_MAX_LOGS",payload:l})},[]),x=o.useCallback(l=>{i({type:"SET_AUTO_SCROLL",payload:l})},[]);return o.useEffect(()=>{if(!t){d.current&&(d.current.close(),d.current=null);return}const l=new EventSource(`/services/${r}/logs`);return d.current=l,l.onmessage=m=>{try{const g=JSON.parse(m.data);a(g)}catch(g){console.error("Error parsing log data:",g)}},l.onerror=m=>{console.error("EventSource error:",m),l.close()},()=>{l.close(),d.current=null}},[r,t,a]),{logs:c.logs,totalLogs:c.totalLogs,maxLogs:c.maxLogs,autoScroll:c.autoScroll,actions:{clearLogs:p,setMaxLogs:h,setAutoScroll:x}}}function _({serviceId:r,serviceName:t,isVisible:c,onClose:i,status:d}){const{logs:a,totalLogs:p,maxLogs:h,autoScroll:x,actions:{clearLogs:l,setMaxLogs:m,setAutoScroll:g}}=T({serviceId:r,isVisible:c}),s=o.useRef(null);o.useEffect(()=>{x&&s.current&&a.length>0&&(s.current.scrollTop=s.current.scrollHeight)},[a,x]);const u=n=>{if(n.stopPropagation(),s.current){const y=s.current,v=y.scrollHeight-y.scrollTop-y.clientHeight<100;g(v)}},f=()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight,g(!0))},b=n=>{switch(n){case"error":return"text-red-400 bg-red-950/30";case"warn":return"text-yellow-400 bg-yellow-950/30";case"debug":return"text-blue-400 bg-blue-950/30";case"verbose":return"text-purple-400 bg-purple-950/30";default:return"text-green-400 bg-transparent"}},j=()=>{switch(d){case"running":return"bg-green-500";case"stopped":return"bg-red-500";case"error":return"bg-red-500";default:return"bg-gray-500"}};return e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",className:`
        fixed inset-0 z-50 flex items-center justify-center p-4
        transition-all duration-500 ease-out
        ${c?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}
      `,children:[e.jsx("div",{className:`
          fixed inset-0 backdrop-blur-sm
          transition-all duration-500 ease-out
          ${c?"bg-black/70":"bg-black/0"}
        `,"aria-hidden":"true",onClick:i}),e.jsxs("div",{role:"document",className:`
          bg-gray-900 w-full h-full max-w-[95vw] max-h-[95vh] rounded-lg 
          flex flex-col overflow-hidden relative z-10
          shadow-2xl shadow-purple-500/10
          transition-all duration-500 ease-out transform
          ${c?"opacity-100 scale-100 translate-y-0 rotate-0":"opacity-0 scale-90 translate-y-8 rotate-1"}
        `,children:[e.jsxs("div",{className:"bg-gray-800 px-6 py-4 flex justify-between items-center border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("h2",{id:"modal-title",className:"text-xl font-semibold text-white flex items-center space-x-2",children:[e.jsx("span",{className:"text-purple-400",children:t}),e.jsx("span",{className:"text-gray-400",children:"Logs"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${j()} animate-pulse`}),e.jsxs("span",{className:"text-sm text-gray-400",children:["Showing ",a.length," of ",p," lines",p>h&&e.jsxs("span",{className:"text-yellow-400 ml-2",children:["(Limited to last ",h,")"]})]})]}),e.jsx("select",{value:h,onChange:n=>m(Number(n.target.value)),className:"bg-gray-700 text-gray-300 text-sm rounded-lg px-3 py-1.5 border border-gray-600 focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:R.map(n=>e.jsxs("option",{value:n,children:["Show ",n," logs"]},n))})]})]}),e.jsx("button",{onClick:i,className:"text-gray-400 hover:text-white transition-colors p-2 hover:bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500","aria-label":"Close logs",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{ref:s,onScroll:u,className:"flex-1 overflow-y-auto p-6 font-mono text-sm overscroll-contain",onWheel:n=>n.stopPropagation(),children:a.length===0?e.jsx("div",{className:"text-gray-500 flex items-center justify-center h-full text-lg",children:e.jsx("span",{children:"Waiting for logs..."})}):e.jsx("div",{className:"space-y-1",children:a.map((n,y)=>e.jsxs("div",{className:`flex whitespace-pre-wrap break-all rounded transition-colors ${b(n.level)}`,children:[e.jsx("div",{className:"w-12 flex-none px-2 py-1 text-gray-500 select-none border-r border-gray-800",children:p-a.length+y+1}),e.jsx("div",{className:"flex-1 px-2 py-1",children:n.message})]},y))})}),e.jsx("div",{className:"bg-gray-800 px-6 py-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 rounded-full bg-red-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Error"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 rounded-full bg-yellow-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Warning"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 rounded-full bg-green-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Info"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 rounded-full bg-blue-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Debug"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 rounded-full bg-purple-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Verbose"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsxs("button",{onClick:()=>g(!x),className:`
                  px-4 py-2 rounded-lg border transition-colors
                  ${x?"bg-purple-500/10 text-purple-400 border-purple-500/20 hover:bg-purple-500/20":"bg-gray-700 text-gray-300 border-gray-600 hover:bg-gray-600"}
                `,children:["Auto-scroll ",x?"ON":"OFF"]}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-lg border border-gray-600 hover:bg-gray-600 transition-colors",children:"Scroll to Bottom ⬇️"}),e.jsx("button",{onClick:l,className:"px-4 py-2 bg-red-500/10 text-red-400 rounded-lg border border-red-500/20 hover:bg-red-500/20 transition-colors",children:"Clear Logs 🗑️"})]})]})})]})]})}function D({service:r}){const t=r.status==="running",c=N(),i=k(),d=S(),[a,p]=o.useState(!1),[h,x]=o.useState(null),[l,m]=o.useState(!1);o.useEffect(()=>{if(i.formData){const s=i.formData,u=s.get("action");s.get("serviceId")===r.id&&(u==="start"||u==="stop")&&(p(!0),x(u))}else if(a){const s=setTimeout(()=>{d.revalidate(),p(!1),x(null)},1e3);return()=>clearTimeout(s)}},[i.formData,r.id,a,d]),o.useEffect(()=>{let s;return a&&(s=setInterval(()=>{d.revalidate()},2e3)),()=>{s&&clearInterval(s)}},[a,d]);const g=s=>{if(s==="refresh"){d.revalidate();return}if(s==="logs"){m(!l);return}const u=new FormData;u.append("action",s),u.append("serviceId",r.id),c(u,{method:"post"})};return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-xl shadow-lg shadow-gray-200/50 dark:shadow-gray-900/50 
      border border-gray-100 dark:border-gray-700
      transition-all duration-300 hover:shadow-xl hover:shadow-purple-500/10 dark:hover:shadow-purple-500/5
      overflow-hidden`,children:[e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[r.name,e.jsx(A,{status:r.status})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Port: ",e.jsx("span",{className:"font-mono bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded",children:r.port})]})]}),e.jsxs(L,{to:`http://localhost:${r.port}/api`,target:"_blank",rel:"noreferrer",className:`text-xs px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-700 
              text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600
              transition-colors duration-200 flex items-center gap-1 group`,children:[e.jsx("span",{children:"API"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3.5 h-3.5 transition-transform duration-200 group-hover:translate-x-0.5",children:e.jsx("path",{fillRule:"evenodd",d:"M5.22 14.78a.75.75 0 001.06 0l7.22-7.22v5.69a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75h-7.5a.75.75 0 000 1.5h5.69l-7.22 7.22a.75.75 0 000 1.06z",clipRule:"evenodd"})})]})]}),r.description&&e.jsx("p",{className:"mt-3 text-sm text-gray-600 dark:text-gray-300 line-clamp-2",children:r.description}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"Last Started"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100",children:r.lastStarted?new Date(r.lastStarted).toLocaleString():"Never"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"Last Stopped"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100",children:r.lastStopped?new Date(r.lastStopped).toLocaleString():"Never"})]})]})]}),e.jsx("div",{className:`px-5 py-4 bg-gray-50/50 dark:bg-gray-800/50 border-t border-gray-100 dark:border-gray-700
        flex items-center justify-end gap-2`,children:e.jsxs("div",{className:"flex items-center gap-2 w-full max-w-lg ml-auto",children:[e.jsx("button",{onClick:()=>g(t?"stop":"start"),disabled:a,className:`
              w-28
              inline-flex items-center justify-center gap-1.5 px-3 py-1.5 
              text-xs font-medium rounded-lg border whitespace-nowrap
              transition-all duration-200
              ${a?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed dark:bg-gray-800 dark:border-gray-700":t?"bg-red-50 text-red-600 border-red-100 hover:bg-red-100 dark:bg-red-500/10 dark:border-red-500/20 dark:hover:bg-red-500/20":"bg-green-50 text-green-600 border-green-100 hover:bg-green-100 dark:bg-green-500/10 dark:border-green-500/20 dark:hover:bg-green-500/20"}
            `,children:a?e.jsxs("span",{className:"flex items-center justify-center gap-1.5",children:[e.jsxs("svg",{className:"animate-spin w-3.5 h-3.5 shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:h==="start"?"Starting":"Stopping"})]}):e.jsx("span",{className:"flex items-center justify-center gap-1.5",children:t?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3.5 h-3.5 shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M5.25 3A2.25 2.25 0 003 5.25v9.5A2.25 2.25 0 005.25 17h9.5A2.25 2.25 0 0017 14.75v-9.5A2.25 2.25 0 0014.75 3h-9.5z"})}),e.jsx("span",{children:"Stop"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3.5 h-3.5 shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})}),e.jsx("span",{children:"Start"})]})})}),e.jsxs("button",{onClick:()=>g("logs"),className:`
              w-28
              inline-flex items-center justify-center gap-1.5 px-3 py-1.5 
              text-xs font-medium rounded-lg border whitespace-nowrap
              transition-all duration-200
              ${l?"bg-purple-50 text-purple-600 border-purple-100 hover:bg-purple-100 dark:bg-purple-500/10 dark:border-purple-500/20 dark:hover:bg-purple-500/20":"bg-gray-50 text-gray-600 border-gray-200 hover:bg-gray-100 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600"}
            `,children:[e.jsx("svg",{className:"w-3.5 h-3.5 shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M10 3c-4.31 0-8 3.033-8 7 0 2.024.978 3.825 2.499 5.085a3.478 3.478 0 01-.522 1.756.75.75 0 00.584 1.143 5.976 5.976 0 003.936-1.108c.487.082.99.124 1.503.124 4.31 0 8-3.033 8-7s-3.69-7-8-7z"})}),e.jsx("span",{children:"Logs"})]}),e.jsxs("button",{onClick:()=>g("refresh"),disabled:a,className:`
              w-28
              inline-flex items-center justify-center gap-1.5 px-3 py-1.5 
              text-xs font-medium rounded-lg border whitespace-nowrap
              bg-gray-50 text-gray-600 border-gray-200 
              hover:bg-gray-100 
              dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 
              dark:hover:bg-gray-600
              transition-all duration-200
              disabled:opacity-50 disabled:cursor-not-allowed
            `,children:[e.jsx("svg",{className:"w-3.5 h-3.5 shrink-0",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39zm1.23-3.723a.75.75 0 00.219-.53V2.929a.75.75 0 00-1.5 0v2.43l-.31-.31A7 7 0 003.239 8.188a.75.75 0 101.448.389A5.5 5.5 0 0113.89 6.11l.311.31h-2.432a.75.75 0 000 1.5h4.243a.75.75 0 00.53-.219z",clipRule:"evenodd"})}),e.jsx("span",{children:"Refresh"})]})]})}),e.jsx(_,{serviceId:r.id,serviceName:r.name,isVisible:l,onClose:()=>m(!1),status:r.status})]})}function I({services:r}){return r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No services available"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Add services to start managing them."})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:r.map(t=>e.jsx(D,{service:t},t.id))})}const B=w(function(){const{services:t}=C();return e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-900 min-h-screen",children:[e.jsx(I,{services:t}),e.jsx("div",{className:"mt-6",children:e.jsx("a",{href:"/services",className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:"Add New Service"})})]})});export{B as default};
